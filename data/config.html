<!DOCTYPE html>
<html><head>
<title>Configure Measurement Node</title>
<meta charset=UTF-8>
<style type=text/css>
body{text-align:center;background-color:#2b4e69;font:normal 12px/18px Arial,Helvetica,sans-serif}
.g{background:#fff;overflow:hidden;border:1px solid #069;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px}
.g table{border-collapse:collapse;text-align:left;width:100%}
.g table tr{height: unset;}
.g table td,.g table th{padding:3px 10px}
.g table thead th{background-color:#069;color:#fff;border-left:1px solid #0070a8}
.g table tbody td{color:#00496b;border-left:1px solid #e1eef4;font-weight:normal}
.g table tfoot td{padding:0;}
.c{display:inline-block;border-radius:2em;padding:2em;background-color:#a6b3be;border:2px solid #0e304a}
.c table{margin:0 auto}
.c tr{height: 30px}
.c th,.c td{text-align:left}
.c .note{font-style: italic}
.c .lastrow{margin: 5px 0px; text-align: right}
</style>
</head>
<body>
<div class=c>
<h1>Configuration</h1>
<form id="dlg" action="/" method="post">
  <table>
    <tr><th>Node</th><td><input id="node" type=text name="node" value="" size="20" maxlength="20"/></td><td class="note">Spaces and slashes are not supported!</td></tr>
    <tr><th>Topic Prefix</th><td><input id="topic" type=text name="topic" value="" size="20" maxlength="20"/></td><td class="note">Spaces and slashes are not supported, use a dot for hierarchy!!</td></tr>
  </table>
	<div class="g">
	<table>
		<thead><tr><th>Active</th><th>Sensor Id</th><th>Type</th><th>Location</th><th>Measurand</th><th>Last Value</th></tr></thead>
		<tbody id="sensor-list">
    </tbody>
    <tfoot>
        <tr>
        <td class="note" colspan="6">Spaces and slashes are not supported, use a dot for hierarchy!<br/>Topic prefix + location will be used as mqtt topic - dots are replaced by slashes.</td>
        </tr>
    </tfoot>
	</table>
	</div>
	<div class="lastrow"><input type=submit name=action value=update /></div>
</form>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
$(document).ready(function() {
    $.ajax({
      url: "http://"+document.location.host+"/node"
    }).then(function(data) {
      $('#node').val(data.node);
    });
    $.ajax({
      url: "http://"+document.location.host+"/topic"
    }).then(function(data) {
      $('#topic').val(data.topic);
    });
    $.ajax({
      url: "http://"+document.location.host+"/sensors"
    }).then(function(data) {
      for (var id in data.sensors) {
        $('#sensor-list').append("<tr>"
          +"<td><input type='checkbox' name='en-"+id+"'/></td>"
          +"<td>"+id+"</td>"
          +"<td>"+data.sensors[id].type+"</td>"
          +"<td><input name='loc-"+id+"' size='30' maxlength='30' value='"+data.sensors[id].location+"'/></td>"
          +"<td>"+data.sensors[id].measurand+"</td>"
          +"<td>"+data.sensors[id].value+"</td></tr>");
      }
    });
});
</script>
</body></html>
