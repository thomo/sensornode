<!DOCTYPE html>
<html><head>
<title>Configure Measurement Node</title>
<meta charset=UTF-8>
<style type=text/css>
body{text-align:center;background-color:#2b4e69;font:normal 12px/18px Arial,Helvetica,sans-serif}
.g{background:#fff;overflow:hidden;border:1px solid #069;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px}
.g table{border-collapse:collapse;text-align:left;width:100%}
.g table tr{height:unset;}
.g table td,.g table th{padding:3px 10px}
.g table thead th{background-color:#069;color:#fff;border-left:1px solid #0070a8}
.g table tbody td{color:#00496b;border-left:1px solid #e1eef4;font-weight:normal}
.g table tfoot td{padding:5px 10px;text-align: center;background-color: lightgray;}
.c{display:inline-block;border-radius:2em;padding:2em;background-color:#a6b3be;border:2px solid #0e304a}
.c table{margin:0 auto}
.c tr{height:30px}
.c th,.c td{text-align:left}
.c .note{font-style:italic}
.c .lastrow{margin:5px 15px;text-align:right}
.c tr.withdisplay{display: none;}
</style>
</head>
<body>
<div class=c>
<h1>SensorNode V<span id="version">1</span> Configuration</h1>
<form id="dlg" action="/" method="post">
  <table>
    <tr><th>Node</th><td><input id="node" type=text name="node" value="" size="20" maxlength="20"/></td><td class="note">Spaces and slashes are not supported!</td></tr>
    <tr><th>Topic Prefix</th><td><input id="topic" type=text name="topic" value="" size="20" maxlength="20"/></td><td class="note">Spaces and slashes are not supported, use a dot for hierarchy!!</td></tr>
    <tr><th>Altitude</th><td><input id="altitude" type=text name="altitude" value="" size="7" maxlength="7"/></td><td class="note">in meters xxxx.x</td></tr>
    <tr class="withdisplay"><th>With display</th><td><input id="display" type='checkbox' name='hasDisplay')/></td><td class="note"></td></tr>
    <tr><th>Read sensors</th><td><input id="sf" type=text name="sf" value="" size="4" maxlength="4"/></td><td class="note">every x seconds</td></tr>
    <tr class="withdisplay"><th>Fetch weather forecast</th><td><input id="ff" type=text name="ff" value="" size="4" maxlength="4"/></td><td class="note">every x seconds (only with display)</td></tr>
  </table>
	<div class="g">
	<table>
		<thead>
      <tr>
        <th>Active</th>
        <th>Display</th>
        <th>Sensor Id</th>
        <th>Type</th>
        <th>Location</th>
        <th>Measurand</th>
        <th>Last Value</th>
        <th>Correction (+/-)</th>
      </tr>
    </thead>
		<tbody id="sensor-list">
    </tbody>
    <tfoot>
        <tr>
        <td class="note" colspan="8">Spaces and slashes are not supported, use a dot for hierarchy!<br/>Topic prefix + location will be used as mqtt topic - dots are replaced by slashes.</td>
        </tr>
    </tfoot>
	</table>
	</div>
	<div class="lastrow"><input type=submit name=action value=update /></div>
</form>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
$(document).ready(function() {
    $.ajax({
      url: "http://"+document.location.host+"/config"
    }).then(function(data) {
      if (data.v > 1) { $('tr.withdisplay').show(); } else { $('tr.withdisplay').hide(); }
      $('#version').text(data.v);
      $('#sf').val(data.sf);
      $('#ff').val(data.ff);
      $('#node').val(data.n);
      $('#topic').val(data.t);
      $('#altitude').val(data.a);
      $('#display').prop("checked", data.d);
    });
    $.ajax({
      url: "http://"+document.location.host+"/sensors"
    }).then(function(data) {
      for (var id in data.sensors) {
        $('#sensor-list').append("<tr>"
          +"<td><input type='checkbox' name='en-"+id+"' " + (data.sensors[id].e == 1 ? "checked" : "") + " /></td>"
          +"<td><input type='radio' name='show' value='"+id+"'"+(data.sensors[id].s == 1 ? " checked" : "")+ "/></td>"
          +"<td>"+id+"</td>"
          +"<td>"+data.sensors[id].t+"</td>"
          +"<td><input name='loc-"+id+"' size='30' maxlength='30' value='"+data.sensors[id].l+"'/></td>"
          +"<td>"+data.sensors[id].m+"</td>"
          +"<td>"+data.sensors[id].v+"</td>"
          +"<td><input name='cor-"+id+"' size='7' maxlength='7' value='"+data.sensors[id].c+"'/></td></tr>");
      }
    });
});
</script>
</body></html>
